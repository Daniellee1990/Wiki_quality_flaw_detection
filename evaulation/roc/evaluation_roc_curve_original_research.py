# coding='UTF-8'
import io
import sys
import os
import re
import pandas as pd
import nltk
import nltk.data
import numpy as np
import tensorflow
import keras
from keras import regularizers, optimizers
from keras import backend as K
from keras.callbacks import TensorBoard
from keras.engine.topology import Layer
from keras.models import Model, Sequential
from keras.layers import Input, Dense, LSTM, Bidirectional, Flatten, Dropout, Multiply, Permute, concatenate
from keras.utils import np_utils
from keras.optimizers import Adam
from sklearn import preprocessing
from sklearn.model_selection import train_test_split, StratifiedKFold
from sklearn.metrics import roc_curve, auc

from keras.callbacks import ReduceLROnPlateau
import matplotlib.pyplot as plt

if __name__ == '__main__':
    # roc values get from the training model

    ### Original research  FPR, TPR, auc
    # content+stats bigru
    content_stats_bigru = [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0021598272138228943, 0.0021598272138228943, 0.004319654427645789, 0.004319654427645789, 0.0064794816414686825, 0.0064794816414686825, 0.008639308855291577, 0.008639308855291577, 0.012958963282937365, 0.012958963282937365, 0.02159827213822894, 0.02159827213822894, 0.028077753779697623, 0.028077753779697623, 0.05183585313174946, 0.05183585313174946, 0.058315334773218146, 0.058315334773218146, 0.06047516198704104, 0.06047516198704104, 0.06263498920086392, 0.06263498920086392, 0.09287257019438445, 0.09287257019438445, 0.1447084233261339, 0.1447084233261339, 0.16414686825053995, 0.16414686825053995, 0.16846652267818574, 0.16846652267818574, 0.19654427645788336, 0.19654427645788336, 0.2224622030237581, 0.2224622030237581, 0.7170626349892009, 0.7170626349892009, 1.0],
                           [0.0, 0.19735099337748344, 0.29668874172185433, 0.3258278145695364, 0.352317880794702, 0.376158940397351, 0.38543046357615895, 0.40264900662251657, 0.41589403973509936, 0.42119205298013246, 0.4291390728476821, 0.4384105960264901, 0.44370860927152317, 0.447682119205298, 0.45827814569536424, 0.46225165562913906, 0.4675496688741722, 0.48079470198675495, 0.4860927152317881, 0.48741721854304637, 0.495364238410596, 0.5006622516556292, 0.5033112582781457, 0.5086092715231788, 0.5099337748344371, 0.5178807947019868, 0.5218543046357615, 0.5245033112582781, 0.5298013245033113, 0.5311258278145695, 0.5364238410596026, 0.5403973509933775, 0.5417218543046357, 0.5536423841059602, 0.5589403973509933, 0.5629139072847682, 0.5655629139072847, 0.5708609271523178, 0.5721854304635762, 0.5827814569536424, 0.5854304635761589, 0.5894039735099338, 0.5947019867549669, 0.5986754966887418, 0.6039735099337749, 0.6066225165562914, 0.6119205298013245, 0.614569536423841, 0.6198675496688741, 0.6278145695364239, 0.6317880794701987, 0.633112582781457, 0.6357615894039735, 0.6410596026490066, 0.6450331125827815, 0.6463576158940397, 0.6503311258278146, 0.6688741721854304, 0.671523178807947, 0.6754966887417219, 0.6781456953642384, 0.6794701986754967, 0.6834437086092715, 0.6874172185430464, 0.6900662251655629, 0.704635761589404, 0.7072847682119205, 0.7112582781456953, 0.713907284768212, 0.7205298013245033, 0.7231788079470198, 0.7271523178807947, 0.7298013245033113, 0.7470198675496689, 0.7496688741721854, 0.7655629139072848, 0.7682119205298014, 0.7695364238410596, 0.7748344370860927, 0.8026490066225166, 0.8052980132450331, 0.9615894039735099, 0.9615894039735099, 0.9642384105960264, 0.9642384105960264, 0.9735099337748344, 0.9735099337748344, 0.976158940397351, 0.976158940397351, 0.9774834437086093, 0.9774834437086093, 0.9814569536423841, 0.9814569536423841, 0.9827814569536424, 0.9827814569536424, 0.9854304635761589, 0.9854304635761589, 0.9867549668874173, 0.9867549668874173, 0.9880794701986755, 0.9880794701986755, 0.9894039735099338, 0.9894039735099338, 0.990728476821192, 0.990728476821192, 0.9920529801324504, 0.9920529801324504, 0.9933774834437086, 0.9933774834437086, 0.9947019867549669, 0.9947019867549669, 0.9960264900662251, 0.9960264900662251, 0.9973509933774835, 0.9973509933774835, 0.9986754966887417, 0.9986754966887417, 1.0, 1.0],
                           [0.9972022370660678]]

    # content bilstm
    content_bilstm = [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
                             0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
                             0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
                             0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0021598272138228943, 
                             0.0021598272138228943, 0.0021598272138228943, 0.0021598272138228943, 0.0021598272138228943, 
                             0.0021598272138228943, 0.0021598272138228943, 0.0021598272138228943, 0.0021598272138228943, 
                             0.0021598272138228943, 0.0021598272138228943, 0.0021598272138228943, 0.0021598272138228943, 
                             0.0021598272138228943, 0.0021598272138228943, 0.0021598272138228943, 0.004319654427645789, 
                             0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 
                             0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 
                             0.0064794816414686825, 0.0064794816414686825, 0.0064794816414686825, 0.0064794816414686825, 
                             0.0064794816414686825, 0.0064794816414686825, 0.008639308855291577, 0.008639308855291577, 
                             0.008639308855291577, 0.008639308855291577, 0.008639308855291577, 0.01079913606911447, 
                             0.01079913606911447, 0.012958963282937365, 0.012958963282937365, 0.01511879049676026, 
                             0.01511879049676026, 0.019438444924406047, 0.019438444924406047, 0.02159827213822894, 
                             0.02159827213822894, 0.02591792656587473, 0.02591792656587473, 0.032397408207343416, 
                             0.032397408207343416, 0.038876889848812095, 0.038876889848812095, 0.04967602591792657, 
                             0.04967602591792657, 0.05183585313174946, 0.05183585313174946, 0.06911447084233262, 
                             0.06911447084233262, 0.08207343412526998, 0.08207343412526998, 0.09503239740820735, 
                             0.09503239740820735, 0.09935205183585313, 0.09935205183585313, 0.10367170626349892, 
                             0.10367170626349892, 0.11231101511879049, 0.11231101511879049, 0.13174946004319654, 
                             0.13174946004319654, 0.13390928725701945, 0.13390928725701945, 0.15550755939524838, 
                             0.15550755939524838, 0.20086393088552915, 0.20086393088552915, 0.21382289416846653, 
                             0.21382289416846653, 0.27213822894168466, 0.27213822894168466, 0.4103671706263499, 
                             0.4103671706263499, 1.0],
                             [0.0, 0.0013245033112582781, 0.026490066225165563, 0.02913907284768212, 0.06225165562913907, 
                             0.06490066225165562, 0.08874172185430464, 0.0913907284768212, 0.10066225165562914, 
                             0.10596026490066225, 0.11258278145695365, 0.1152317880794702, 0.11920529801324503, 
                             0.12185430463576159, 0.1271523178807947, 0.12980132450331125, 0.1456953642384106, 
                             0.14834437086092717, 0.16158940397350993, 0.16423841059602648, 0.16556291390728478, 
                             0.16821192052980133, 0.17483443708609273, 0.17748344370860927, 0.1814569536423841, 
                             0.18410596026490067, 0.19337748344370861, 0.19602649006622516, 0.2304635761589404, 
                             0.23311258278145697, 0.24370860927152319, 0.24635761589403973, 0.24900662251655628, 
                             0.2543046357615894, 0.2556291390728477, 0.2582781456953642, 0.2635761589403974, 
                             0.2662251655629139, 0.27417218543046357, 0.27947019867549666, 0.2860927152317881, 
                             0.28874172185430463, 0.304635761589404, 0.3072847682119205, 0.3125827814569536, 
                             0.3152317880794702, 0.3205298013245033, 0.3258278145695364, 0.32847682119205296, 
                             0.33112582781456956, 0.3390728476821192, 0.34172185430463575, 0.3456953642384106, 
                             0.3483443708609272, 0.3509933774834437, 0.3536423841059603, 0.3576158940397351, 
                             0.36026490066225164, 0.41589403973509936, 0.4185430463576159, 0.4357615894039735, 
                             0.4384105960264901, 0.447682119205298, 0.4503311258278146, 0.47152317880794703, 
                             0.4741721854304636, 0.48079470198675495, 0.48344370860927155, 0.5139072847682119, 
                             0.5152317880794702, 0.5165562913907285, 0.519205298013245, 0.5205298013245033, 
                             0.5231788079470199, 0.552317880794702, 0.5549668874172186, 0.5827814569536424, 
                             0.5854304635761589, 0.609271523178808, 0.6119205298013245, 0.633112582781457, 
                             0.6357615894039735, 0.6397350993377483, 0.6423841059602649, 0.6688741721854304, 
                             0.6688741721854304, 0.671523178807947, 0.7125827814569536, 0.7152317880794702, 
                             0.7165562913907285, 0.7192052980132451, 0.7231788079470198, 0.7271523178807947, 
                             0.7483443708609272, 0.7483443708609272, 0.7549668874172185, 0.7576158940397351, 
                             0.8052980132450331, 0.8079470198675497, 0.8158940397350993, 0.8158940397350993, 
                             0.8609271523178808, 0.8635761589403973, 0.8860927152317881, 0.8887417218543047, 
                             0.8887417218543047, 0.928476821192053, 0.928476821192053, 0.9443708609271523, 
                             0.9443708609271523, 0.9549668874172186, 0.9549668874172186, 0.9615894039735099, 
                             0.9615894039735099, 0.9629139072847682, 0.9629139072847682, 0.9655629139072848, 
                             0.9655629139072848, 0.9682119205298013, 0.9682119205298013, 0.9708609271523179, 
                             0.9708609271523179, 0.9748344370860927, 0.9748344370860927, 0.976158940397351, 
                             0.976158940397351, 0.9788079470198675, 0.9788079470198675, 0.9814569536423841, 
                             0.9814569536423841, 0.9827814569536424, 0.9827814569536424, 0.9841059602649007, 
                             0.9841059602649007, 0.9854304635761589, 0.9854304635761589, 0.9867549668874173, 
                             0.9867549668874173, 0.990728476821192, 0.990728476821192, 0.9920529801324504, 
                             0.9920529801324504, 0.9947019867549669, 0.9947019867549669, 0.9960264900662251, 
                             0.9960264900662251, 0.9973509933774835, 0.9973509933774835, 0.9986754966887417, 
                             0.9986754966887417, 1.0, 1.0], 
                             [0.9932702072575916]]

    # stats dnn
    stats_dnn = [[0.0, 0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 
                  0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 
                  0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 
                  0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 
                  0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 
                  0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 
                  0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 
                  0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 
                  0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 
                  0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 0.004319654427645789, 
                  0.004319654427645789, 0.004319654427645789, 0.0064794816414686825, 0.0064794816414686825, 
                  0.008639308855291577, 0.008639308855291577, 0.01079913606911447, 0.01079913606911447, 
                  0.012958963282937365, 0.012958963282937365, 0.01511879049676026, 0.01511879049676026, 
                  0.019438444924406047, 0.019438444924406047, 0.02159827213822894, 0.02159827213822894, 
                  0.02591792656587473, 0.02591792656587473, 0.028077753779697623, 0.028077753779697623, 
                  0.03023758099352052, 0.03023758099352052, 0.0367170626349892, 0.0367170626349892, 
                  0.04319654427645788, 0.04319654427645788, 0.047516198704103674, 0.047516198704103674, 
                  0.04967602591792657, 0.04967602591792657, 0.05399568034557235, 0.05399568034557235, 
                  0.06047516198704104, 0.06047516198704104, 0.07127429805615551, 0.07127429805615551, 
                  0.0734341252699784, 0.0734341252699784, 0.0755939524838013, 0.0755939524838013, 
                  0.09503239740820735, 0.09503239740820735, 0.09719222462203024, 0.09719222462203024, 
                  0.09935205183585313, 0.09935205183585313, 0.12311015118790497, 0.12311015118790497, 
                  0.12742980561555076, 0.12742980561555076, 0.1511879049676026, 0.1511879049676026, 
                  0.1879049676025918, 0.1879049676025918, 0.21166306695464362, 0.21166306695464362, 
                  0.23326133909287258, 0.23326133909287258, 1.0],
                  [0.0, 0.38543046357615895, 0.44503311258278144, 0.4821192052980132, 0.5033112582781457, 
                  0.5125827814569537, 0.5231788079470199, 0.5258278145695364, 0.5311258278145695, 
                  0.5337748344370861, 0.5417218543046357, 0.5483443708609271, 0.5536423841059602, 
                  0.5642384105960265, 0.5668874172185431, 0.5695364238410596, 0.5708609271523178, 
                  0.5735099337748344, 0.5761589403973509, 0.5814569536423841, 0.5827814569536424, 
                  0.5867549668874172, 0.590728476821192, 0.5933774834437087, 0.6013245033112583, 
                  0.6039735099337749, 0.6052980132450331, 0.6079470198675496, 0.6105960264900663, 
                  0.614569536423841, 0.633112582781457, 0.6357615894039735, 0.6635761589403973, 
                  0.6662251655629139, 0.6701986754966888, 0.6754966887417219, 0.695364238410596, 
                  0.6980132450331126, 0.713907284768212, 0.7165562913907285, 0.7403973509933774, 
                  0.743046357615894, 0.7880794701986755, 0.7880794701986755, 0.9364238410596026, 
                  0.9364238410596026, 0.9470198675496688, 0.9470198675496688, 0.9509933774834437, 
                  0.9509933774834437, 0.9549668874172186, 0.9549668874172186, 0.9576158940397351, 
                  0.9576158940397351, 0.9589403973509933, 0.9589403973509933, 0.9629139072847682, 
                  0.9629139072847682, 0.9655629139072848, 0.9655629139072848, 0.9682119205298013, 
                  0.9682119205298013, 0.9695364238410596, 0.9695364238410596, 0.9708609271523179, 
                  0.9708609271523179, 0.9735099337748344, 0.9735099337748344, 0.9748344370860927, 
                  0.9748344370860927, 0.976158940397351, 0.976158940397351, 0.9774834437086093, 
                  0.9774834437086093, 0.9801324503311258, 0.9801324503311258, 0.9814569536423841, 
                  0.9814569536423841, 0.9841059602649007, 0.9841059602649007, 0.9854304635761589, 
                  0.9854304635761589, 0.9867549668874173, 0.9867549668874173, 0.9880794701986755, 
                  0.9880794701986755, 0.990728476821192, 0.990728476821192, 0.9920529801324504, 
                  0.9920529801324504, 0.9933774834437086, 0.9933774834437086, 0.9947019867549669, 
                  0.9947019867549669, 0.9973509933774835, 0.9973509933774835, 0.9986754966887417, 
                  0.9986754966887417, 1.0, 1.0],
                  [0.9928968861299043]]


    content_stats_bigru_fpr = np.array(content_stats_bigru[0])
    content_stats_bigru_tpr = np.array(content_stats_bigru[1])
    content_stats_bigru_roc_auc = content_stats_bigru[2][0]

    content_bilstm_fpr = np.array(content_bilstm[0])
    content_bilstm_tpr = np.array(content_bilstm[1])
    content_bilstm_roc_auc = content_bilstm[2][0]

    stats_dnn_fpr = np.array(stats_dnn[0])
    stats_dnn_tpr = np.array(stats_dnn[1])
    stats_dnn_roc_auc = stats_dnn[2][0]


    #开始画ROC曲线
    lw = 1.5
    plt.plot(content_stats_bigru_fpr, content_stats_bigru_tpr, 
            color='#FF8C00', linestyle='-', lw=lw, label='Content+stats BiGRU (AUC = %0.4f)'% content_stats_bigru_roc_auc)
    plt.plot(content_bilstm_fpr, content_bilstm_tpr, 
            color='#A52A2A', linestyle='--', lw=lw,label='Content BiLSTM (AUC = %0.4f)'% content_bilstm_roc_auc)
    plt.plot(stats_dnn_fpr, stats_dnn_tpr, 
            color='#ADFF2F', linestyle='-', lw=lw,label='Stats DNN (AUC = %0.4f)'% stats_dnn_roc_auc)

    plt.legend(loc='lower right')
    plt.plot([0,1],[0,1],color='#191970', linestyle='--')
    plt.xlim([-0.1,1.1])
    plt.ylim([-0.1,1.1])
    plt.xlabel('False Positive Rate') #横坐标是fpr
    plt.ylabel('True Positive Rate')  #纵坐标是tpr
    plt.title('Receiver operating characteristic')
    plt.show()
